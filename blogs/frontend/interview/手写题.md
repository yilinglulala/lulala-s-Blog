## æ‰‹å†™ promise

[BATå‰ç«¯ç»å…¸é¢è¯•é—®é¢˜ï¼šå²ä¸Šæœ€æœ€æœ€è¯¦ç»†çš„æ‰‹å†™Promiseæ•™ç¨‹](https://juejin.cn/post/6844903625769091079)

### ç®€æ˜“ç‰ˆ

```js
class MyPromise {
 Â constructor(fn){
 Â  Â // å­˜å‚¨ reslove å›è°ƒå‡½æ•°åˆ—è¡¨
 Â  Â this.callbacks = []
 Â  Â const resolve = (value) => {
 Â  Â  Â this.data = value // è¿”å›å€¼ç»™åé¢çš„ .then
 Â  Â  Â while(this.callbacks.length) {
 Â  Â  Â  Â let cb = this.callbacks.shift()
 Â  Â  Â  Â cb(value)
 Â  Â   }
 Â   }
 Â  Â fn(resolve)
  }
 Â then(onResolvedCallback) {
 Â  Â return new MyPromise((resolve) => {
 Â  Â  Â this.callbacks.push(() => {
 Â  Â  Â  Â const res = onResolvedCallback(this.data)
 Â  Â  Â  Â if (res instanceof MyPromise) {
 Â  Â  Â  Â  Â res.then(resolve)
 Â  Â  Â   } else {
 Â  Â  Â  Â  Â resolve(res)
 Â  Â  Â   }
 Â  Â   })
 Â   })
  }
}
// è¿™æ˜¯æµ‹è¯•æ¡ˆä¾‹
new MyPromise((resolve) => {
 Â setTimeout(() => {
 Â  Â resolve(1)
  }, 1000)
}).then((res) => {
 Â  Â console.log(res)
 Â  Â return new MyPromise((resolve) => {
 Â  Â  Â setTimeout(() => {
 Â  Â  Â  Â resolve(2)
 Â  Â   }, 1000)
 Â   })
}).then(res =>{console.log(res)})
```



## æ‰‹å†™new

```js
function myNew(fn, ...args) {
    // åˆ¤æ–­å‚æ•°æ˜¯å¦æ˜¯ä¸€ä¸ªå‡½æ•°
    if (typeof fn !== "function") {
        return console.error("type error");
    }
    // åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å°†å¯¹è±¡çš„åŸå‹ç»‘å®šåˆ°æ„é€ å‡½æ•°çš„åŸå‹ä¸Š
    const obj = Object.create(fn.prototype);
    const value = fn.apply(obj, args); // è°ƒç”¨æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”thisç»‘å®šåˆ°objä¸Š
    // å¦‚æœæ„é€ å‡½æ•°æœ‰è¿”å›å€¼ï¼Œå¹¶ä¸”è¿”å›çš„æ˜¯å¯¹è±¡ï¼Œå°±è¿”å›value ;å¦åˆ™è¿”å›obj
    return value instanceof Object ? value : obj;
}
```



## Object.create

```js
function create(obj) {
 Â function F() {}
 Â F.prototype = obj
 Â return new F()
}
```



## call / apply / bind

```js
fn.call(obj,1,2,3) 
fn.apply(obj,[1,2,3])// å‚æ•°ä¸ºæ•°ç»„
fn.bind(obj,[1,2,3]) // å¹¶ä¸ç«‹å³æ‰§è¡Œ
```

ğŸ**åŒ**

- éƒ½æ˜¯functionåŸå‹ä¸Šçš„æ–¹æ³•

- éƒ½æ˜¯è°ƒç”¨å‡½æ•°

- éƒ½å¯ä»¥æ”¹å˜thisæŒ‡å‘

ğŸ**ä¸åŒ**

- apply æ¥æ”¶çš„å‚æ•°æ˜¯æ•°ç»„

**ğŸ“Œæ³¨æ„**

> call çš„æ€§èƒ½ä¼šæ¯”applyå¥½ä¸€ä¸¢ä¸¢(å°¤å…¶æ˜¯ä¼ å‚å¤§äº3ä¸ªçš„æ—¶å€™)
>
> bindå¹¶ä¸ç«‹å³æ‰§è¡Œ

### ğŸ”¥æ‰‹å†™call

```js
Function.prototype.myCall = function(context, ...args) {
  context = context || window
  let fn = Symbol()
  context[fn] = this
  let result = context[fn](...args)
  delete context[fn]
  return result
}
```



### ğŸ”¥æ‰‹å†™apply

```js
Function.prototype.myApply = function(context) {
  context = context || window
  let fn = Symbol()
  context[fn] = this
  let result
  if (arguments[1]) {
    result = context[fn](...arguments[1])
  } else {
    result = context[fn]()
  }
  delete context[fn]
  return result
}
```

### ğŸ”¥æ‰‹å†™bind

```js
Function.prototype.myBind = function (context) {
  var fn = this
  var args = [...arguments].slice(1)// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯thisæŒ‡å‘
  // è¿”å›ä¸€ä¸ªå‡½æ•°
  return function F() {
    // å› ä¸ºè¿”å›äº†ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ new F()ï¼Œæ‰€ä»¥éœ€è¦åˆ¤æ–­
    if (this instanceof F) {
      return new fn(...args, ...arguments)
    }
    return fn.apply(context, args.concat(...arguments))
  }
}
// ä½¿ç”¨
fn.myBind(obj,[1,2,3])
```

```js
// axios
function bind(fn, thisArg) {
  return function wrap() {
    return fn.apply(thisArg, arguments);
  };
}
```



## ğŸ‘€instanceof

åŸç†:

```js
function instanceof(left, right) {
    // è·å¾—ç±»å‹çš„åŸå‹
    let prototype = right.prototype
    // è·å¾—å¯¹è±¡çš„åŸå‹
    left = left.__proto__;// Object.getPrototypeOf(left)
    // åˆ¤æ–­å¯¹è±¡çš„ç±»å‹æ˜¯å¦ç­‰äºç±»å‹çš„åŸå‹
    while (true) {
    	if (left === null)
    		return false
    	if (prototype === left)
    		return true
    	left = left.__proto__
    }
}
// instanceof({},Object)
```

## Array æ•°ç»„

### ğŸ”¥æ‰‹å†™Array.map

```js
function mymap(arr,cb){
    let res = []
    if(Array.isArray(arr)&&arr.length&&typeof cb === 'function'){
        for(let i=0,i<arr.length;i++){
            res[i] = cb(arr[i],i,arr)
        }
    }
    return res
}
```



## ğŸ”¥é˜²æŠ–/èŠ‚æµ

### **é˜²æŠ–**

è§¦å‘äº‹ä»¶ï¼Œä¸€å®šæ—¶é—´å†…æ²¡æœ‰é‡æ–°è§¦å‘ä¼šæ‰§è¡Œï¼Œå¦‚æœé‡æ–°è§¦å‘åˆ™æ¸…æ‰å®šæ—¶å™¨ï¼Œé‡æ–°å®šæ—¶

å®é™…åœºæ™¯ï¼šæœç´¢æ¡†åœæ­¢è¾“å…¥nç§’åæ‰æ‰§è¡Œæœç´¢

1. ç®€æ˜“ç‰ˆ

```js
// funcæ˜¯ç”¨æˆ·ä¼ å…¥éœ€è¦é˜²æŠ–çš„å‡½æ•°
// waitæ˜¯ç­‰å¾…æ—¶é—´
const debounce = (func, wait = 50) => {
  // ç¼“å­˜ä¸€ä¸ªå®šæ—¶å™¨id
  let timer = 0
  // è¿™é‡Œè¿”å›çš„å‡½æ•°æ˜¯æ¯æ¬¡ç”¨æˆ·å®é™…è°ƒç”¨çš„é˜²æŠ–å‡½æ•°
  // å¦‚æœå·²ç»è®¾å®šè¿‡å®šæ—¶å™¨äº†å°±æ¸…ç©ºä¸Šä¸€æ¬¡çš„å®šæ—¶å™¨
  // å¼€å§‹ä¸€ä¸ªæ–°çš„å®šæ—¶å™¨ï¼Œå»¶è¿Ÿæ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„æ–¹æ³•
  return function(...args) {
    if (timer) clearTimeout(timer)
    timer = setTimeout(() => {
      func.apply(this, args)
    }, wait)
  }
}
// ä¸éš¾çœ‹å‡ºå¦‚æœç”¨æˆ·è°ƒç”¨è¯¥å‡½æ•°çš„é—´éš”å°äº wait çš„æƒ…å†µä¸‹ï¼Œä¸Šä¸€æ¬¡çš„æ—¶é—´è¿˜æœªåˆ°å°±è¢«æ¸…é™¤äº†ï¼Œå¹¶ä¸ä¼šæ‰§è¡Œå‡½æ•°
```

2. å¸¦æœ‰ç«‹å³æ‰§è¡Œé€‰é¡¹çš„**`é˜²æŠ–å‡½æ•°`**

```js
/**
 * é˜²æŠ–å‡½æ•°ï¼Œè¿”å›å‡½æ•°è¿ç»­è°ƒç”¨æ—¶ï¼Œç©ºé—²æ—¶é—´å¿…é¡»å¤§äºæˆ–ç­‰äº waitï¼Œfunc æ‰ä¼šæ‰§è¡Œ
 *
 * @param  {function} func        å›è°ƒå‡½æ•°
 * @param  {number}   wait        è¡¨ç¤ºæ—¶é—´çª—å£çš„é—´éš”
 * @param  {boolean}  immediate   è®¾ç½®ä¸ºtureæ—¶ï¼Œæ˜¯å¦ç«‹å³è°ƒç”¨å‡½æ•°ï¼Œç«‹å³è°ƒç”¨åœ¨æ—¶é—´ç‰‡å¤´æ‰§è¡Œï¼Œéç«‹å³æ‰§è¡Œåœ¨æ—¶é—´ç‰‡å°¾æ‰§è¡Œ
 * @return {function}             è¿”å›å®¢æˆ·è°ƒç”¨å‡½æ•°
 */
function debounce (func, wait = 50, immediate = true) {
  let timer, context, args
  
  // å»¶è¿Ÿæ‰§è¡Œå‡½æ•°
  const later = () => setTimeout(() => {
    // å»¶è¿Ÿå‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œæ¸…ç©ºç¼“å­˜çš„å®šæ—¶å™¨åºå·
    timer = null
    // å»¶è¿Ÿæ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œå‡½æ•°ä¼šåœ¨å»¶è¿Ÿå‡½æ•°ä¸­æ‰§è¡Œ
    // ä½¿ç”¨åˆ°ä¹‹å‰ç¼“å­˜çš„å‚æ•°å’Œä¸Šä¸‹æ–‡
    if (!immediate) {
      func.apply(context, args)
      context = args = null
    }
  }, wait)

  // è¿™é‡Œè¿”å›çš„å‡½æ•°æ˜¯æ¯æ¬¡å®é™…è°ƒç”¨çš„å‡½æ•°
  return function(...params) {
    // å¦‚æœæ²¡æœ‰åˆ›å»ºå»¶è¿Ÿæ‰§è¡Œå‡½æ•°ï¼ˆlaterï¼‰ï¼Œå°±åˆ›å»ºä¸€ä¸ª
    if (!timer) {
      timer = later()
      // å¦‚æœæ˜¯ç«‹å³æ‰§è¡Œï¼Œè°ƒç”¨å‡½æ•°
      // å¦åˆ™ç¼“å­˜å‚æ•°å’Œè°ƒç”¨ä¸Šä¸‹æ–‡
      if (immediate) {
        func.apply(this, params)
      } else {
        context = this
        args = params
      }
    // å¦‚æœå·²æœ‰å»¶è¿Ÿæ‰§è¡Œå‡½æ•°ï¼ˆlaterï¼‰ï¼Œè°ƒç”¨çš„æ—¶å€™æ¸…é™¤åŸæ¥çš„å¹¶é‡æ–°è®¾å®šä¸€ä¸ª
    // è¿™æ ·åšå»¶è¿Ÿå‡½æ•°ä¼šé‡æ–°è®¡æ—¶
    } else {
      clearTimeout(timer)
      timer = later()
    }
  }
}
```

### èŠ‚æµ

åœ¨ä¸€å®šçš„æ—¶é—´å†…ï¼Œè¿ç»­ç‚¹å‡»næ¬¡ï¼Œåªæœ‰ä¸€æ¬¡ä¼šç”Ÿæ•ˆ

**å®é™…åœºæ™¯ï¼š**

- æŠ€èƒ½å†·å´
- æŒ‰é’®è¿ç»­ç‚¹å‡»

1. ç®€æ˜“ç‰ˆ

```js
function thro(fn,wait){
    let timer
    return function(...args){
        if(!timer){
            timer = setTimeout(()=>{
                fn.apply(this,args)
                timer = null
            },wait)
        }
    }
}
```



```js
/**
 * underscore èŠ‚æµå‡½æ•°ï¼Œè¿”å›å‡½æ•°è¿ç»­è°ƒç”¨æ—¶ï¼Œfunc æ‰§è¡Œé¢‘ç‡é™å®šä¸º æ¬¡ / wait
 *
 * @param  {function}   func      å›è°ƒå‡½æ•°
 * @param  {number}     wait      è¡¨ç¤ºæ—¶é—´çª—å£çš„é—´éš”
 * @param  {object}     options   å¦‚æœæƒ³å¿½ç•¥å¼€å§‹å‡½æ•°çš„çš„è°ƒç”¨ï¼Œä¼ å…¥{leading: false}ã€‚
 *                                å¦‚æœæƒ³å¿½ç•¥ç»“å°¾å‡½æ•°çš„è°ƒç”¨ï¼Œä¼ å…¥{trailing: false}
 *                                ä¸¤è€…ä¸èƒ½å…±å­˜ï¼Œå¦åˆ™å‡½æ•°ä¸èƒ½æ‰§è¡Œ
 * @return {function}             è¿”å›å®¢æˆ·è°ƒç”¨å‡½æ•°   
 */
_.throttle = function(func, wait, options) {
    var context, args, result;
    var timeout = null;
    // ä¹‹å‰çš„æ—¶é—´æˆ³
    var previous = 0;
    // å¦‚æœ options æ²¡ä¼ åˆ™è®¾ä¸ºç©ºå¯¹è±¡
    if (!options) options = {};
    // å®šæ—¶å™¨å›è°ƒå‡½æ•°
    var later = function() {
      // å¦‚æœè®¾ç½®äº† leadingï¼Œå°±å°† previous è®¾ä¸º 0
      // ç”¨äºä¸‹é¢å‡½æ•°çš„ç¬¬ä¸€ä¸ª if åˆ¤æ–­
      previous = options.leading === false ? 0 : _.now();
      // ç½®ç©ºä¸€æ˜¯ä¸ºäº†é˜²æ­¢å†…å­˜æ³„æ¼ï¼ŒäºŒæ˜¯ä¸ºäº†ä¸‹é¢çš„å®šæ—¶å™¨åˆ¤æ–­
      timeout = null;
      result = func.apply(context, args);
      if (!timeout) context = args = null;
    };
    return function() {
      // è·å¾—å½“å‰æ—¶é—´æˆ³
      var now = _.now();
      // é¦–æ¬¡è¿›å…¥å‰è€…è‚¯å®šä¸º true
	  // å¦‚æœéœ€è¦ç¬¬ä¸€æ¬¡ä¸æ‰§è¡Œå‡½æ•°
	  // å°±å°†ä¸Šæ¬¡æ—¶é—´æˆ³è®¾ä¸ºå½“å‰çš„
      // è¿™æ ·åœ¨æ¥ä¸‹æ¥è®¡ç®— remaining çš„å€¼æ—¶ä¼šå¤§äº0
      if (!previous && options.leading === false) previous = now;
      // è®¡ç®—å‰©ä½™æ—¶é—´
      var remaining = wait - (now - previous);
      context = this;
      args = arguments;
      // å¦‚æœå½“å‰è°ƒç”¨å·²ç»å¤§äºä¸Šæ¬¡è°ƒç”¨æ—¶é—´ + wait
      // æˆ–è€…ç”¨æˆ·æ‰‹åŠ¨è°ƒäº†æ—¶é—´
 	  // å¦‚æœè®¾ç½®äº† trailingï¼Œåªä¼šè¿›å…¥è¿™ä¸ªæ¡ä»¶
	  // å¦‚æœæ²¡æœ‰è®¾ç½® leadingï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡ä¼šè¿›å…¥è¿™ä¸ªæ¡ä»¶
	  // è¿˜æœ‰ä¸€ç‚¹ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—å¼€å¯äº†å®šæ—¶å™¨é‚£ä¹ˆåº”è¯¥ä¸ä¼šè¿›å…¥è¿™ä¸ª if æ¡ä»¶äº†
	  // å…¶å®è¿˜æ˜¯ä¼šè¿›å…¥çš„ï¼Œå› ä¸ºå®šæ—¶å™¨çš„å»¶æ—¶
	  // å¹¶ä¸æ˜¯å‡†ç¡®çš„æ—¶é—´ï¼Œå¾ˆå¯èƒ½ä½ è®¾ç½®äº†2ç§’
	  // ä½†æ˜¯ä»–éœ€è¦2.2ç§’æ‰è§¦å‘ï¼Œè¿™æ—¶å€™å°±ä¼šè¿›å…¥è¿™ä¸ªæ¡ä»¶
      if (remaining <= 0 || remaining > wait) {
        // å¦‚æœå­˜åœ¨å®šæ—¶å™¨å°±æ¸…ç†æ‰å¦åˆ™ä¼šè°ƒç”¨äºŒæ¬¡å›è°ƒ
        if (timeout) {
          clearTimeout(timeout);
          timeout = null;
        }
        previous = now;
        result = func.apply(context, args);
        if (!timeout) context = args = null;
      } else if (!timeout && options.trailing !== false) {
        // åˆ¤æ–­æ˜¯å¦è®¾ç½®äº†å®šæ—¶å™¨å’Œ trailing
	    // æ²¡æœ‰çš„è¯å°±å¼€å¯ä¸€ä¸ªå®šæ—¶å™¨
        // å¹¶ä¸”ä¸èƒ½ä¸èƒ½åŒæ—¶è®¾ç½® leading å’Œ trailing
        timeout = setTimeout(later, remaining);
      }
      return result;
    };
  };
```

## æŸ¯é‡ŒåŒ–

```js
function curry(fn, ...args) {
 Â return fn.length <= args.length ? fn(...args) : curry.bind(null, fn, ...args);
}
```

